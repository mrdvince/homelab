{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "customManagers": [
    {
      "customType": "regex",
      "fileMatch": ["^infrastructure/images/images/.*\\.yaml$"],
      "matchStrings": [
        "registry:\\s*(?<registry>[^\\n]+)\\n\\s*image:\\s*(?<depName>[^\\n]+)\\n\\s*tag:\\s*[\"']?(?<currentValue>[^\"'\\n]+)[\"']?"
      ],
      "datasourceTemplate": "docker",
      "packageNameTemplate": "{{registry}}/{{depName}}"
    }
  ],
  "ignoreDeps": [
    "registry.home.mrdvince.me/homelab/builder",
    "secret",
    "clusterissuer",
    "cilium-config",
    "actual",
    "bar-assistant"
  ],
  "packageRules": [
    {
      "matchManagers": ["regex"],
      "matchFileNames": ["infrastructure/images/images/**"],
      "groupName": "container images"
    },
    {
      "matchManagers": ["helmfile"],
      "matchUpdateTypes": ["minor", "patch"],
      "groupName": "helm charts (minor/patch)"
    },
    {
      "matchPackagePatterns": ["^gitlab-org/"],
      "groupName": "gitlab stack"
    },
    {
      "matchPackagePatterns": ["^grafana/", "^prometheus", "kube-prometheus-stack"],
      "groupName": "monitoring stack"
    },
    {
      "matchPackagePatterns": ["^cilium/"],
      "groupName": "cilium"
    },
    {
      "matchUpdateTypes": ["minor", "patch"],
      "automerge": true
    },
    {
      "matchUpdateTypes": ["major"],
      "dependencyDashboardApproval": true
    }
  ]
}
